on: [push]
  
jobs:
  build:
    env:
      IMAGE_NAME: quay.io/eclipse/che-sidecar-camelk
    runs-on: ubuntu-latest
    steps:
    
    - name: Clone source code
      uses: actions/checkout@v2
      with:
        fetch-depth: 1
        path: this-repo

    - name: Clone source code
      uses: actions/checkout@v2
      with:
        fetch-depth: 1
        repository: ericwill/fake-plugin-registry
        path: this-repo/plugin-registry
    
    - name: ls
      id: list
      uses: che-dockerfiles/plugin-sidecar-update-action@v4
      with:
        plugin-registry: this-repo/plugin-registry
    
    - name: Get output
      run: |
        cat this-repo/plugin-registry/vscode-extensions.json

    - name: Create PR
      uses: peter-evans/create-pull-request@v3
      with:
        commit-message: "Test PR"
        committer: Eric Williams <ericwill@redhat.com>
        author: Eric Williams <ericwill@redhat.com>
        branch: test-sidecar-update-action-pr
        path: this-repo/plugin-registry
        base: master